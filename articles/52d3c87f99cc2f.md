---
title: "Javascript ã§ UUID (v4) ã‚’ç”Ÿæˆã™ã‚‹"
emoji: "ğŸ™"
type: "tech"
topics: ["javascript"]
published: true
---

UUIDã«ã¯ã„ãã¤ã‹ã®å¤‰ç¨®ã‚„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ãŒã€ãã®ä¸­ã§ã‚‚*RFC 4122*ã®ä¸­ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³4ã¯å˜ç´”ã«ä¹±æ•°ã§ç”Ÿæˆã™ã‚‹ã¨ã„ã†éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚

è‡ªå‰ã§ä½œã‚‹ã®ã‚‚ç°¡å˜ãªã®ã§ã€å®Ÿéš›ã«Javascriptã§ã‚‚æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚

# å®Ÿéš›ã«ä½œã£ã¦ã¿ã‚‹
```JavaScript:ãã®ï¼‘
class UUID {

  static #uuidIte = ( function* () {

    const HEXOCTETS = Object.freeze( [ ...Array( 0x100 ) ].map( ( e, i ) => i.toString( 0x10 ).padStart( 2, "0" ).toUpperCase() ) );
    const VARSION = 0x40;
    const VARIANT = 0x80;

    for (;;) {

      const bytes = crypto.getRandomValues( new Uint8Array( 16 ) );
      yield "" +
        HEXOCTETS[ bytes[ 0 ] ] +
        HEXOCTETS[ bytes[ 1 ] ] +
        HEXOCTETS[ bytes[ 2 ] ] +
        HEXOCTETS[ bytes[ 3 ] ] + "-" +
        HEXOCTETS[ bytes[ 4 ] ] +
        HEXOCTETS[ bytes[ 5 ] ] + "-" +
        HEXOCTETS[ bytes[ 6 ] & 0x0f | VARSION ] +
        HEXOCTETS[ bytes[ 7 ] ] + "-" +
        HEXOCTETS[ bytes[ 8 ] & 0x3f | VARIANT ] +
        HEXOCTETS[ bytes[ 9 ] ] + "-" +
        HEXOCTETS[ bytes[ 10 ] ] +
        HEXOCTETS[ bytes[ 11 ] ] +
        HEXOCTETS[ bytes[ 12 ] ] +
        HEXOCTETS[ bytes[ 13 ] ] +
        HEXOCTETS[ bytes[ 14 ] ] +
        HEXOCTETS[ bytes[ 15 ] ];

    }

  } )();

  static randomUUID() {

    return this.#uuidIte.next().value;

  }

}

console.log( UUID.randomUUID() ); //e.g. 16E3908E-96DF-468E-B148-90A11814615F
```

ã¤ã„ã§ã«ã€Node.jsã§ã¯çµ„ã¿è¾¼ã¿ã«`crypto`ãŒãªã„ã‚ˆã†ãªã®ã§ã€`Math.random()`ã‚’ä½¿ã£ãŸå®Ÿè£…ã‚‚è¼‰ã›ã¾ã™ã€‚

```Javascript:ãã®ï¼’ï¼ˆcryptoæœªä½¿ç”¨ï¼‰
class UUID {

  static #uuidIte = ( function* () {

    const HEXOCTETS = Object.freeze( [ ...Array( 0x100 ) ].map( ( e, i ) => i.toString( 0x10 ).padStart( 2, "0" ).toUpperCase() ) );
    const VARSION = 0x40;
    const VARIANT = 0x80;
    const bytes = new Uint8Array( 16 );
    const rand = new Uint32Array( bytes.buffer );

    for (;;) {

      for ( let i = 0; i < rand.length; i++ ) {
        rand[ i ] = Math.random() * 0x100000000 >>> 0;
      }

      yield "" +
        HEXOCTETS[ bytes[ 0 ] ] +
        HEXOCTETS[ bytes[ 1 ] ] +
        HEXOCTETS[ bytes[ 2 ] ] +
        HEXOCTETS[ bytes[ 3 ] ] + "-" +
        HEXOCTETS[ bytes[ 4 ] ] +
        HEXOCTETS[ bytes[ 5 ] ] + "-" +
        HEXOCTETS[ bytes[ 6 ] & 0x0f | VARSION ] +
        HEXOCTETS[ bytes[ 7 ] ] + "-" +
        HEXOCTETS[ bytes[ 8 ] & 0x3f | VARIANT ] +
        HEXOCTETS[ bytes[ 9 ] ] + "-" +
        HEXOCTETS[ bytes[ 10 ] ] +
        HEXOCTETS[ bytes[ 11 ] ] +
        HEXOCTETS[ bytes[ 12 ] ] +
        HEXOCTETS[ bytes[ 13 ] ] +
        HEXOCTETS[ bytes[ 14 ] ] +
        HEXOCTETS[ bytes[ 15 ] ];

    }

  } )();

  static randomUUID() {

    return this.#uuidIte.next().value;

  }

}

console.log( UUID.randomUUID() ); //e.g. 16E3908E-96DF-468E-B148-90A11814615F
```

ä»¥ä¸Šï¼
åˆ†æ•£å‹ã§ã‹ãªã‚Šé«˜é€Ÿã«ç”Ÿæˆã§ãã‚‹ã®ã«ä¸€æ„ãªå€¤ã¨ã—ã¦ä½¿ãˆã‚‹ã®ã¯ä¸æ€è­°ãªæ„Ÿã˜ãŒã—ã¾ã™ã€‚
